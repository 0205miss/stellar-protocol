## Preamble

```
SEP: SEP-0005
Title: Key Derivation Methods for Stellar Accounts
Author: stellar.org
Status: Accepted
Created: 2017-11-09
```

## Simple Summary
This Stellar Ecosystem Proposal describes methods for key derivation for Stellar. This should improve key storage and moving keys between wallets and apps.

## Motivation
Currently the only way to store Stellar account's keys is by saving a long str-encoded string which represents a secret key. However many industry standards have been developed for deriving keys which improve key storage and moving keys between wallets. Adapting these standards for Stellar accounts should improve Stellar ecosystem by:
* making key derivation the same across wallets and apps,
* allowing users to hold keys in hardware wallets,
* allowing users to hold keys in cold storage more reliably (using mnemonic codes),
* allowing users to generate multiple keys from a single seed (ex. first for storing funds and second as a signer for a shared account).

## Specification

### Key Derivation for `ed25519`

[SLIP-0010](https://github.com/satoshilabs/slips/blob/master/slip-0010.md) should be used for key derivation for `ed25519`.

### Multi-Account Hierarchy for Deterministic Wallets

We adapt [BIP-0044](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) for generating deterministic wallets, with `coin_type` equal `148` as assigned in [SLIP-0044](https://github.com/satoshilabs/slips/blob/master/slip-0044.md).

The following path should be used to generate accounts: `m/44'/148'/x'`. We call `m/44'/148'/0'` the _primary account_.

### Mnemonic Codes

[BIP-0039](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki) should be used to derive binary seed from a mnemonic code.

## Rationale
`BIP`s and `SLIP`s are industry standards used by a majority of cryptocurrencies and software/hardware wallets.

We decided not to use the full derivation path specified in [BIP-0044](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) because of several reasons. First, `ed25519` key derivation from [SLIP-0010](https://github.com/satoshilabs/slips/blob/master/slip-0010.md) does not allow child key derivation from non-hardened keys. Second, each account in Stellar network is required to hold a [minimum balance](https://www.stellar.org/developers/guides/concepts/fees.html). We assume that majority of users will use a single, primary account.

## Test Cases

### Test 1

Mnemonic (15 words):
```
resource asthma orphan phone ice canvas fire useful arch jewel impose vague theory cushion top
```
BIP39 Seed:
```
7b36d4e725b48695c3ffd2b4b317d5552cb157c1a26c46d36a05317f0d3053eb8b3b6496ba39ebd9312d10e3f9937b47a6790541e7c577da027a564862e92811
```
`m/44'/148'` key:
```
2e5d4e6b54a4b96c5e887c9ec92f619a3c134d8b1059dcef15c1a9b228ae3751
```
Accounts:
```
m/44'/148'/0' GAVXVW5MCK7Q66RIBWZZKZEDQTRXWCZUP4DIIFXCCENGW2P6W4OA34RH SAKS7I2PNDBE5SJSUSU2XLJ7K5XJ3V3K4UDFAHMSBQYPOKE247VHAGDB
m/44'/148'/1' GDFCYVCICATX5YPJUDS22KM2GW5QU2KKSPPPT2IC5AQIU6TP3BZSLR5K SAZ2H5GLAVWCUWNPQMB6I3OHRI63T2ACUUAWSH7NAGYYPXGIOPLPW3Q4
m/44'/148'/2' GAUA3XK3SGEQFNCBM423WIM5WCZ4CR4ZDPDFCYSFLCTODGGGJMPOHAAE SDVSSLPL76I33DKAI4LFTOAKCHJNCXUERGPCMVFT655Z4GRLWM6ZZTSC
m/44'/148'/3' GAH3S77QXTAPZ77REY6LGFIJ2XWVXFOKXHCFLA6HQTL3POLVZJDHHUDM SCH56YSGOBYVBC6DO3ZI2PY62GBVXT4SEJSXJOBQYGC2GCEZSB5PEVBZ
m/44'/148'/4' GCSCZVGV2Y3EQ2RATJ7TE6PVWTW5OH5SMG754AF6W6YM3KJF7RMNPB4Y SBWBM73VUNBGBMFD4E2BA7Q756AKVEAAVTQH34RYEUFD6X64VYL5KXQ2
m/44'/148'/5' GDKWYAJE3W6PWCXDZNMFNFQSPTF6BUDANE6OVRYMJKBYNGL62VKKCNCC SAVS4CDQZI6PSA5DPCC42S5WLKYIPKXPCJSFYY4N3VDK25T2XX2BTGVX
m/44'/148'/6' GCDTVB4XDLNX22HI5GUWHBXJFBCPB6JNU6ZON7E57FA3LFURS74CWDJH SDFC7WZT3GDQVQUQMXN7TC7UWDW5E3GSMFPHUT2TSTQ7RKWTRA4PLBAL
m/44'/148'/7' GBTDPL5S4IOUQHDLCZ7I2UXJ2TEHO6DYIQ3F2P5OOP3IS7JSJI4UMHQJ SA6UO2FIYC6AS2MSDECLR6F7NKCJTG67F7R4LV2GYB4HCZYXJZRLPOBB
m/44'/148'/8' GD3KWA24OIM7V3MZKDAVSLN3NBHGKVURNJ72ZCTAJSDTF7RIGFXPW5FQ SBDNHDDICLLMBIDZ2IF2D3LH44OVUGGAVHQVQ6BZQI5IQO6AB6KNJCOV
m/44'/148'/9' GB3C6RRQB3V7EPDXEDJCMTS45LVDLSZQ46PTIGKZUY37DXXEOAKJIWSV SDHRG2J34MGDAYHMOVKVJC6LX2QZMCTIKRO5I4JQ6BJQ36KVL6QUTT72
```

### Test 2

Mnemonic (24 words):
```
bench hurt jump file august wise shallow faculty impulse spring exact slush thunder author capable act festival slice deposit sauce coconut afford frown better
```
BIP39 Seed:
```
937ae91f6ab6f12461d9936dfc1375ea5312d097f3f1eb6fed6a82fbe38c85824da8704389831482db0433e5f6c6c9700ff1946aa75ad8cc2654d6e40f567866
```
`m/44'/148'` key:
```
df474e0dc2711089b89af6b089aceeb77e73120e9f895bd330a36fa952835ea8
```
Accounts:
```
m/44'/148'/0' GC3MMSXBWHL6CPOAVERSJITX7BH76YU252WGLUOM5CJX3E7UCYZBTPJQ SAEWIVK3VLNEJ3WEJRZXQGDAS5NVG2BYSYDFRSH4GKVTS5RXNVED5AX7
m/44'/148'/1' GB3MTYFXPBZBUINVG72XR7AQ6P2I32CYSXWNRKJ2PV5H5C7EAM5YYISO SBKSABCPDWXDFSZISAVJ5XKVIEWV4M5O3KBRRLSPY3COQI7ZP423FYB4
m/44'/148'/2' GDYF7GIHS2TRGJ5WW4MZ4ELIUIBINRNYPPAWVQBPLAZXC2JRDI4DGAKU SD5CCQAFRIPB3BWBHQYQ5SC66IB2AVMFNWWPBYGSUXVRZNCIRJ7IHESQ
m/44'/148'/3' GAFLH7DGM3VXFVUID7JUKSGOYG52ZRAQPZHQASVCEQERYC5I4PPJUWBD SBSGSAIKEF7JYQWQSGXKB4SRHNSKDXTEI33WZDRR6UHYQCQ5I6ZGZQPK
m/44'/148'/4' GAXG3LWEXWCAWUABRO6SMAEUKJXLB5BBX6J2KMHFRIWKAMDJKCFGS3NN SBIZH53PIRFTPI73JG7QYA3YAINOAT2XMNAUARB3QOWWVZVBAROHGXWM
m/44'/148'/5' GA6RUD4DZ2NEMAQY4VZJ4C6K6VSEYEJITNSLUQKLCFHJ2JOGC5UCGCFQ SCVM6ZNVRUOP4NMCMMKLTVBEMAF2THIOMHPYSSMPCD2ZU7VDPARQQ6OY
m/44'/148'/6' GCUDW6ZF5SCGCMS3QUTELZ6LSAH6IVVXNRPRLAUNJ2XYLCA7KH7ZCVQS SBSHUZQNC45IAIRSAHMWJEJ35RY7YNW6SMOEBZHTMMG64NKV7Y52ZEO2
m/44'/148'/7' GBJ646Q524WGBN5X5NOAPIF5VQCR2WZCN6QZIDOSY6VA2PMHJ2X636G4 SC2QO2K2B4EBNBJMBZIKOYSHEX4EZAZNIF4UNLH63AQYV6BE7SMYWC6E
m/44'/148'/8' GDHX4LU6YBSXGYTR7SX2P4ZYZSN24VXNJBVAFOB2GEBKNN3I54IYSRM4 SCGMC5AHAAVB3D4JXQPCORWW37T44XJZUNPEMLRW6DCOEARY3H5MAQST
m/44'/148'/9' GDXOY6HXPIDT2QD352CH7VWX257PHVFR72COWQ74QE3TEV4PK2KCKZX7 SCPA5OX4EYINOPAUEQCPY6TJMYICUS5M7TVXYKWXR3G5ZRAJXY3C37GF
```

### Test 3

Mnemonic (24 words + password):
```
cable spray genius state float twenty onion head street palace net private method loan turn phrase state blanket interest dry amazing dress blast tube

p4ssw0rd
```
BIP39 Seed:
```
f5022677dc998ec7e072942649cfaf677882feaa0cef34be42af606b9d71bf139e6d24c6ccf06b3875a302ead9cf0756f4304e77e8252b6b69b7acf400ccbf1f
```
`m/44'/148'` key:
```
8ecd804c12aad56987d43b8c37a8c2665a4a8b4d196077a54a74cd9d70f83e0f
```
Accounts:
```
m/44'/148'/0' GCIF62QQTQZ4PZYMUBBEYY2G3AQNNK3MH6P2JXBQSWURELTFVSGG3KAU SBBIF67PGJHOJBH4A6QXZMTTWFPP4YKFVD5HGFG5BCNGGDMYB6XSEUMM
m/44'/148'/1' GDYKQHMPFN7K33CEM4WYJRGUHVBOAX5SPB2VUQNPKADRK6422XBA6HL2 SAAAWKJHOFVPF5MUEJURJR3H54SMV2JFC6MFH3ST4TD3O5ZPQ62LIIXC
m/44'/148'/2' GAXC7AQXRIRN5APNR5ARG5HQQXRRWVLNGXDNVRFL4HM4CQZZF3TEE6SD SBTX2WXC4PMPMCUEK545AXR33NHJDE3UU6LSTLEUUZID6LDE4KA2FYFY
m/44'/148'/3' GBPF2XJRML7SAKVSSWEBP6GUBUQDUXB6RB7UZYV7QQJ74Y36EHWKTM3K SALJIEHJ4BQRM5YJ47SLJWQGL6HV3RLYOR3NI72BLJTXL53IEKAAC3HT
m/44'/148'/4' GDQ54D5PWKYYGDH2TFBS6T5CCRLMH6BJHFP342CN3MRYFRUZWSTCKVPV SD3KGGEULHUOBZXTBVYIFF25DZXTPDDFEVN3NJZVMKY53J4Q3PNI7VSZ
m/44'/148'/5' GBQXJQPXGV4OED3NDKADMUJEWRHH7A2HUESARKKUEKJV5JH7XXMCJC7T SD5OMV72VJ2FWC76FU6DEE4ROUJ4ZKYS7ZWI6WMJTX56LQM7JROFK4V4
m/44'/148'/6' GBTYLEQCTSFJQMJYZLLRZFV6XSLGIGYZH2DSX5YZ43WOIQL7XIW3V55H SAYEIW57ZO4YLJPCU2P2RYZM4SAFRX4SGOEZWN3WNTN6DBSKCWTT63ZN
m/44'/148'/7' GCOVJMGQ6IXX2OX25QTLX5ODTV6Z2NEEPKHK35QSZLEHQOLPTJULVEDG SDLISB3NFDSMFJR2VGVTJC2WMHBB6GJ4QGDYBR7TXV3UPSAGVP36ETPT
m/44'/148'/8' GCNOR3DGJ63VH5F2EKLE7WPZKXJ6DPJH7XFZWLDTBPCMSFDKBD4PWFHU SBR2DWNWVXCRRGATQWFOBRR5PAIB6T2XDZAUL4T7S33STBH4ZYK3PPL7
m/44'/148'/9' GBEX64QNFQICQMDY2CLZ3EU7443F5I7YJGQ6ZYHIAQQZBNWJI6GQIOGI SACPGR336TQBBKOZ7URRFLU7E24EHRWZYWIJV5HDS5BRM6HBNX76IR54
```

## Implementation
* Console HD wallet: https://github.com/stellar/go/tree/master/tools/stellar-hd-wallet
* Go package for `ed25519` key derivation: https://github.com/stellar/go/tree/master/exp/crypto/derive

## Acknowledgements
Many thanks for @lenondupe for implementing Ledger app and @zulucrypto for starting a discussion about key derivation.
